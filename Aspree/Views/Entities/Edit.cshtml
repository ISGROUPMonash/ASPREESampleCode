@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";

    var jsonResult = ViewBag.FormVariableDataJson;
    var entityformdatavariableViewModel = ViewBag.entityformdatavariableViewModel;

    Aspree.Core.ViewModels.LoggedInUser LoggedInUser = new Aspree.Core.ViewModels.LoggedInUser();
    try { LoggedInUser = ViewBag.LoggedInUser as Aspree.Core.ViewModels.LoggedInUser; } catch (Exception exc) { }

}
 @section NavBarLeft{
        <h3 class="text-themecolor m-b-0 m-t-0">@LoggedInUser.ProjectDisplayName</h3>
}
@section NavBarRight{

}
 <div class="col-sm-4 col-md-4 col-lg-3 hide">
    <div class="main-content TabCard">
        <div class="justify-content-lg-center">
            <div class="col-md-11">
                <div class="card">
                    <div class="card-body">
                        @Html.Partial("~/Views/Shared/ManageSystemAdminTools.cshtml")
                        <div class="tab-content tabcontent-border">
                            <div class="tab-pane active" id="manageproject" role="tabpanel">
                                <div class="p-20">
                                    <h4 class="card-title">Edit Entity</h4>
                                    <div class="pb-library-list-wrap">
                                        <div class="list-menu-wrap">
                                            <ul class="list-menu hide">
                                                @foreach (var menu in Model.categories)
                                                {
                                                    <li class="list-dropdown">
                                                        <a href="javascript:void(0);">@menu.CategoryName</a>
                                                        <div class="list-submenu">
                                                            <ul>
                                                                @foreach (var subMenu in menu.Variables)
                                                                {
                                                                    <li><a href="javascript:void(0);" ondblclick="variableDblClick(event);" class="draggable">@subMenu.Name <input type="hidden" id="subMenuHiddenVar" value="@subMenu.Guid" />   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </a> </li>
                                                                }
                                                            </ul>
                                                        </div>
                                                    </li>
                                                }
                                            </ul>
                                        </div><!-- /.list-menu-wrap -->
                                    </div>
                                </div><!-- /.card-body -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 
<div class="col-sm-8 col-md-8 col-lg-12">
    <div class="main-content TabCard">
        <div class="justify-content-lg-center">
            <div class="col-md-11">
                <div class="card">
                    
                    <div class="card-body">
                        @Html.Partial("~/Views/Shared/ManageSystemAdminTools.cshtml")
                        <div class="tab-content tabcontent-border">
                            <div class="tab-pane active" id="manageproject" role="tabpanel">
                                <div class="p-20">
                                    <h4 class="card-title">Edit Entity</h4>
                                    <form id="roleForm" class="form-horizontal" method="post" action="/EntityFormDataVariable/Create" autocomplete="off">
                                        <input id="TenantId" name="TenantId" value="@Model.TenantId" type="hidden" />
                                        <input type="hidden" name="EntityGuid" id="EntityGuid" value="@Model.entityData.Guid" />

                                        <div class="form-group">
                                            <label for="EntityName" class="">Entity Name<span class="text-danger">*</span></label>
                                            <input type="text" name="EntityName" id="EntityName" value="@entityformdatavariableViewModel.EntityName" class="form-control" required="required" maxlength="30" />
                                            @Html.ValidationMessage("EntityName", new { @class = "form-control-feedback" })
                                        </div>

                                        <div class="form-group">
                                            <input type="hidden" name="Guid" id="Guid" value="@entityformdatavariableViewModel.Guid" />
                                            <label for="EntityType" class="">Entity Type<span class="text-danger">*</span></label>
                                            <select class="form-control" id="EntityType" disabled>
                                                <option value="0">Entity Type</option>
                                                @foreach (var item in Model.entities)
                                                {
                                                    if (item.Guid == entityformdatavariableViewModel.EntityTypeGuid)
                                                    {
                                                        <option value="@item.Guid" selected="selected">@item.Name</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Guid">@item.Name</option>
                                                    }

                                                }
                                            </select>
                                            @Html.ValidationMessage("EntityType", new { @class = "form-control-feedback" })
                                        </div>
                                        @{string displayType = "none";}
                                        @if (entityformdatavariableViewModel.EntitySubTypeGuid != null)
                                        {
                                            displayType = "block";
                                        }
                                        <div class="form-group" id="divEntitySubtype" style="display:@displayType;">
                                            <label for="EntitySubtype" class="">Entity Subtype<span class="text-danger">*</span></label>
                                            <select id="EntitySubtype" class="form-control" disabled>
                                                <option selected="true" disabled>Entity Subtype</option>

                                                @foreach (var entitysubtype in Model.entitiesSubType)
                                                {
                                                    if (entitysubtype.EntityTypeId == entityformdatavariableViewModel.EntityTypeGuid)
                                                    {
                                                        if (entitysubtype.Guid == entityformdatavariableViewModel.EntitySubTypeGuid)
                                                        {
                                                            <option value="@entitysubtype.Guid" selected="selected">@entitysubtype.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@entitysubtype.Guid">@entitysubtype.Name</option>
                                                        }
                                                    }
                                                }


                                            </select>
                                            @Html.ValidationMessage("EntitySubtype", new { @class = "form-control-feedback" })
                                        </div>

                                        @{var i = 0; }
                                        @foreach (var variable in Model.entityData.EntityVariableList)
                                        {
                                            i++;
                                            <input type="hidden" value="@variable.Guid" id="variableid-@i" />
                                            <div class="form-group" id="variables">
                                                <label id="question-@i" style="display:none;">@variable.Question</label>
                                                <label for="Question" class="question-key">
                                                    @variable.Question
                                                    @if (variable.IsRequired)
                                                    {
                                                        <span class="text-danger">*</span>
                                                    }
                                                </label>

                                                @if (variable.VariableType == "Free Text")
                                                {
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="Free Text" id="answerType-@i" />
                                                            <input class='form-control form-control-sm answer-value' name='txtFreeText' id='answerVal-@i' value='@freetext.Answer' />
                                                            @Html.ValidationMessage("Name", new { @class = "form-control-feedback" })
                                                        }
                                                    }
                                                }
                                                else if (variable.VariableType == "Dropdown")
                                                {
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="select" id="answerType-@i" />
                                                            <select class='form-control answer-value' id='answerVal-@i' name='QuestionType'>
                                                                <option value='0'>Select</option>
                                                                @foreach (var ddl in variable.Values)
                                                                {
                                                                    if (freetext.Answer == ddl)
                                                                    {
                                                                        <option value='@ddl' selected="selected">@ddl</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value='@ddl'>@ddl</option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                    }
                                                }
                                                else if (variable.VariableType == "Checkbox")
                                                {
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="checkbox" id="answerType-@i" />

                                                            foreach (var chk in variable.Values)
                                                            {
                                                                var isChecked = "";
                                                                foreach (var a in freetext.Answer)
                                                                {
                                                                    if (a == chk)
                                                                    {
                                                                        isChecked = "checked";
                                                                    }
                                                                }
                                                                var data = freetext.Answer;
                                                                <label class="custom-control custom-checkbox">
                                                                    <input type="checkbox" name='answerVal-@i' id='answerVal-@i' value="@chk" class="custom-control-input answer-value" @isChecked />
                                                                    <span class="custom-control-label">@chk </span>
                                                                </label>
                                                            }
                                                        }
                                                    }
                                                }
                                                else if (variable.VariableType == "Radio")
                                                {
                                                     
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="radio" id="answerType-@i" />


                                                            foreach (var radio in variable.Values)
                                                            {

                                                                if (freetext.Answer == radio)
                                                                {

                                                                    <label class="custom-control custom-radio">
                                                                        <input type="radio" name="answerVal-@i" id='answerVal-@i' value="@radio" class="custom-control-input answer-value" checked="checked" />
                                                                        <span class="custom-control-label">@radio </span>
                                                                    </label>
                                                                }
                                                                else
                                                                {
                                                                    <label class="custom-control custom-radio">
                                                                        <input type="radio" name="answerVal-@i" id='answerVal-@i' value="@radio" class="custom-control-input answer-value" />
                                                                        <span class="custom-control-label">@radio </span>
                                                                    </label>
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                else if (variable.VariableType == "Numeric")
                                                {
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="Numeric" id="answerType-@i" />

                                                            <input class='form-control form-control-sm answer-value' name='numericvalue' id='answerVal-@i' value='@freetext.Answer' />
                                                        }
                                                    }
                                                }
                                                else if (variable.VariableType == "Formula")
                                                {
                                                    foreach (var freetext in jsonResult.Json)
                                                    {
                                                        if (freetext.VariableId == variable.Guid)
                                                        {
                                                            <input type="hidden" value="Formula" id="answerType-@i" />
                                                            <input class='form-control form-control-sm ' name='formulavalue' id='answerVal-@i' value='@freetext.Answer' />
                                                        }
                                                    }
                                                }
                                            </div>
                                        }
                                        <input type="hidden" value="@i" id="variableCount" />
                                        <div class="form-group form-group-bottom">
                                            <a href="/SystemAdminTools/ManageEntities" class="btn btn-inverse waves-effect waves-light pull-right">Cancel</a>
                                            <button type="button" onclick="Entity.EntityFormDataVariable(true)" class="btn waves-effect waves-light btn-info pull-right m-r-10">Save</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles{
    <link href="/content/assets/plugins/ion-rangeslider/css/ion.rangeSlider.css" rel="stylesheet">
    <link href="/content/assets/plugins/ion-rangeslider/css/ion.rangeSlider.skinModern.css" rel="stylesheet">
}
@section Scripts {
    <script src="/content/assets/plugins/ion-rangeslider/js/ion-rangeSlider/ion.rangeSlider.min.js"></script>
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(function () {
            $(".list-dropdown > a").click(function () {
                $(".list-submenu").slideUp(200);
                if ($(this).parent().hasClass("active")) {
                    $(".list-dropdown").removeClass("active");
                    $(this).parent().removeClass("active");
                } else {
                    $(".list-dropdown").removeClass("active");
                    $(this).next(".list-submenu").slideDown(200);
                    $(this).parent().addClass("active");
                }
            });
        });
    </script>
    <script>
        $(function () {
            $('.system-admin-tools li a').removeClass('active show');
            $('.system-admin-tools li a:eq(8)').addClass('active show');

            $('#sidebarnav > li').removeClass('active');
            $('#sidebarnav > li:nth-child(6)').addClass('active');
        })
    </script>
    @Scripts.Render("~/apps/entities")
}