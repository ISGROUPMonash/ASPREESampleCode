@model  List<Aspree.Core.ViewModels.ActivityCategoryViewModel>
@{
    ViewBag.Title = "Scheduling";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
    //var Roles = ViewBag.Roles as List<Aspree.Core.ViewModels.RoleModel>;
    //var FormCategories = ViewBag.FormCategories as List<Aspree.Core.ViewModels.FormCategoryViewModel>;
    var EntityTypes = ViewBag.EntityTypes as List<Aspree.Core.ViewModels.EntityTypeViewModel>;
    var IsProjectAdmin = ViewBag.LoggedInUser.Roles.Contains("Project Admin");

    //var endTypeNever = (int)Aspree.Core.Enum.ScheduleEndsTypes.Never;
    //var endTypeOn = (int)Aspree.Core.Enum.ScheduleEndsTypes.On;
    //var endTypeAfter = (int)Aspree.Core.Enum.ScheduleEndsTypes.After;
}

@section NavBarLeft{
    <h3 class="text-themecolor m-b-0 m-t-0">Project Builder</h3>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
        <li class="breadcrumb-item">Project Builder</li>
        <li class="breadcrumb-item active">Scheduling</li>
    </ol>
}

<div class="col-sm-4 col-md-4 col-lg-3">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Library</h3>
            <h4 class="card-subtitle">Existing Activities</h4>
            <form class="form-horizontal" autocomplete="off">
                <div class="input-group form-group">
                    <input onkeyup="Schedule.search(false)" class="form-control" id="search-var-text" style="border-radius: .25rem 0 0 .25rem;" />
                    <div class="input-group-append">
                        <button onclick="Schedule.search(true)" class="btn btn-info" type="button"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            </form>
        </div><!-- /.card-header -->
        <div class="card-body">
            <div class="pb-library-list-wrap">
                <div class="list-menu-wrap">
                    <ul class="list-menu">
                        @foreach (var menu in Model)
                        {
                            <li class="list-dropdown">
                                <a href="javascript:void(0);" id="@menu.Guid">@menu.CategoryName</a>
                                <div class="list-submenu" style="display:none">
                                    <ul class="variable-categories">
                                        @foreach (var subMenu in menu.Activities)
                                        {
                                            if (ViewBag.ProjectId.ToString() == subMenu.ProjectId.ToString())
                                            {
                                                <li data-variable="@subMenu.Guid">
                                                    <a class="sub-category-txt" data-default-activity-type="@subMenu.IsDefaultVariable" data-entity-type-guid="@subMenu.EntityType.FirstOrDefault()" data-text="@subMenu.Name.ToLower()" href="javascript:void(0);" onclick="Schedule.edit('@subMenu.Guid','@subMenu.Name')">@subMenu.Name <i id="li-@subMenu.Guid" data-activity-id="@subMenu.Guid" class="activities-list-entered-label"></i></a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" name="ActivityGuid" id="ActivityGuid" />
<input type="hidden" name="ActivityCategoryGuid" id="ActivityCategoryGuid" />
<input type="hidden" id="ProjectId" name="ProjectId" value="@ViewBag.ProjectId" />
<input type="hidden" id="Guid" name="Guid" />


<div class="col-sm-8 col-md-8 col-lg-9">
    <div class="card">
        <div class="card-body">
            @Html.Partial("~/Views/Shared/ProjectBuilder.cshtml")
        </div>
        <div class="row p-10">
            <div class="col-sm-10 col-md-10 col-lg-12">
                <div class="card">
                    <form class="form-horizontal" id="frm-schedule-activity">
                        <div class="card-header">
                            <div class="form-group m-b-0 col-md-4 col-12">
                                <label for="ActivityName">Activity Name</label>
                                <input class="form-control" id="ActivityName" name="ActivityName" required data-val="true" data-val-required="Please select an activity from Existing Activities Library." readonly />
                            </div> <span class="field-validation-valid form-control-feedback pl-3" data-valmsg-for="ActivityName" data-valmsg-replace="true"></span>
                            
                        </div>
                        <div class="card-body">
                            <h2>Generate Schedule for an Activity</h2>
                            <div style="min-height:250px">


                                <div class="row p-2">
                                    <div class="col-lg-6">
                                        @*When should the schedule start for this activity?*@
                                        When is the activity scheduled to be completed?
                                    </div>
                                    <div class="col-lg-6">
                                        <select class="form-control scheduling-questions" id="ScheduledToBeCompleted" name="ScheduledToBeCompleted" onblur="Schedule.onScheduledToBeCompletedChange(this)" onchange="Schedule.onScheduledToBeCompletedChange(this)" required data-val="true" data-val-required="This field is required.">
                                            <option value="">Please Select</option>
                                            <option value="1">Unscheduled</option>
                                            <option value="2">Offset from another activity</option>
                                            @*<option value="2">From registration of the project to the system</option>
                                                <option value="3">From entity registration with the project</option>*@
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="ScheduledToBeCompleted" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="row p-2 divOffset_from_another_activity hide">
                                    @*<div class="col-lg-2"></div>*@
                                    <div class="col-lg-6">
                                        Select other activity:
                                    </div>
                                    <div class="col-lg-6">
                                        <select id="parentActivityId" name="parentActivityId" class="form-control validate-form">
                                            <option value="" selected>Select Activity</option>
                                            @foreach (var menu in Model)
                                            {
                                                foreach (var subMenu in menu.Activities)
                                                {
                                                    if (ViewBag.ProjectId.ToString() == subMenu.ProjectId.ToString())
                                                    {
                                                        if (subMenu.IsDefaultVariable == (int)Aspree.Core.Enum.DefaultActivityType.Default)
                                                        {
                                                            <option data-is-default="true" value="@subMenu.Guid">@subMenu.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option data-is-default="false" class="dropdown-disabled-options-background" disabled value="@subMenu.Guid">@subMenu.Name</option>
                                                        }
                                                    }
                                                }
                                            }
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="parentActivityId" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="row p-2 divOffset_from_another_activity hide">
                                    @*<div class="col-lg-2"></div>*@
                                    <div class="col-lg-6">
                                        Set offset:
                                    </div>
                                    <div class="col-lg-2">
                                        <select id="offsetCount" class="form-control validate-form">
                                            @for (int i = 1; i <= 30; i++)
                                            {
                                                <option value="@i">@i</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-4">
                                        @Html.DropDownList("offsetType", ViewBag.OffsetType as SelectList, new { @class = "form-control validate-form" })


                                        @*<select id="offsetType" class="form-control validate-form">
                                                <option value="1">Day</option>
                                                <option value="2">Weeks</option>
                                                <option value="3">Month</option>
                                                <option value="4">Year</option>
                                            </select>*@
                                    </div>
                                </div>


                                <div class="row p-2">
                                    <div class="col-lg-6">
                                        @*When should the activity be able to be created on the system?*@
                                        When should the activity be available for creation on the summary page?
                                    </div>
                                    <div class="col-lg-6">
                                        <select class="form-control scheduling-questions" id="ActivityAvailableForCreation" name="ActivityAvailableForCreation" onblur="Schedule.onActivityAvailableForCreationChange(this)" onchange="Schedule.onActivityAvailableForCreationChange(this)" required data-val="true" data-val-required="This field is required.">
                                            <option value="">Please Select</option>
                                            <option value="1">Always available</option>
                                            <option value="2">Only if specified activity had already been created</option>
                                            <option value="3">Based on calendar month before or after scheduled date</option>
                                            <option value="4">Based on days before or after scheduled date</option>
                                            @*<option value="2">Only if another activity has already occurred</option>
                                                <option value="3">Time period before/after scheduled time</option>*@
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="ActivityAvailableForCreation" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="row p-2 divBased_on_scheduled_date hide">
                                    @*<div class="col-lg-2"></div>*@
                                    <div class="col-lg-6">
                                        Creation window opens:
                                    </div>
                                    <div class="col-lg-2">
                                        <input type="number" class="form-control creation-window" placeholder="Number" id="txtCreationWindowOpen" name="txtCreationWindowOpen" />
                                    </div>  
                                    <span class="offset-md-6 field-validation-valid form-control-feedback pl-3 mtl" data-valmsg-for="txtCreationWindowOpen" data-valmsg-replace="true"></span>
                                    
                                </div>
                                <div class="row p-2 divBased_on_scheduled_date hide">
                                    <div class="col-lg-6">
                                        Creation window close:
                                    </div>
                                    <div class="col-lg-2">
                                        <input type="number" class="form-control creation-window" placeholder="Number" id="txtCreationWindowClose" name="txtCreationWindowClose" />
                                    </div>
                                     <span class="offset-md-6  field-validation-valid form-control-feedback pl-3 mtl" data-valmsg-for="txtCreationWindowClose" data-valmsg-replace="true"></span>
                                   
                                </div>

                                <div class="row p-2 divActivity_already_created hide">
                                    <div class="col-lg-6">
                                        Specified activity that must already by created:
                                    </div>
                                    <div class="col-lg-6">
                                        <select class="form-control" id="txtActivityAlreadyCreated" name="txtActivityAlreadyCreated">
                                            <option value="" selected>Select Activity</option>
                                            @foreach (var menu in Model)
                                            {
                                                foreach (var subMenu in menu.Activities)
                                                {
                                                    if (ViewBag.ProjectId.ToString() == subMenu.ProjectId.ToString())
                                                    {

                                                        if (subMenu.IsDefaultVariable == (int)Aspree.Core.Enum.DefaultActivityType.Default)
                                                        {
                                                            <option data-is-default="true" value="@subMenu.Guid">@subMenu.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option data-is-default="false" class="dropdown-disabled-options-background" disabled value="@subMenu.Guid">@subMenu.Name</option>
                                                        }

                                                    }
                                                }
                                            }
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="txtActivityAlreadyCreated" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-lg-6">
                                        Which roles should be able to create the activity as scheduled?
                                    </div>
                                    <div class="col-lg-6">

                                        <select class="form-control scheduling-questions" id="RolesToCreateActivity" name="RolesToCreateActivity" required data-val="true" data-val-required="This field is required." data-style="form-control btn-secondary btn-sm">
                                            <option value="">Please Select</option>
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="RolesToCreateActivity" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-lg-6">
                                        Which roles should be able to create the activity regardless of schedule?
                                    </div>
                                    <div class="col-lg-6">
                                        <select class="form-control scheduling-questions" id="ddlRegardlessScheduledRole" name="ddlRegardlessScheduledRole" required data-val="true" data-val-required="This field is required."  data-style="form-control btn-secondary btn-sm">
                                            <option value="">Please Select</option>
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="ddlRegardlessScheduledRole" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="row p-2">
                                    <div class="col-lg-6">
                                        Can this activity be created multiple times?
                                    </div>
                                    <div class="col-lg-6">
                                        <select class="form-control scheduling-questions" id="ddlCanCreatedMultipleTime" name="ddlCanCreatedMultipleTime" required data-val="true" data-val-required="This field is required.">
                                            <option value="">Please Select</option>
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                        <span class="field-validation-valid form-control-feedback" data-valmsg-for="ddlCanCreatedMultipleTime" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="card-footer">
                        <a href="/projectbuilder" class="btn btn-inverse waves-effect waves-light pull-right">Cancel</a>
                        <a href="/projectbuilder/Activities/@ViewBag.ProjectId" class="btn btn-inverse waves-effect waves-light pull-right m-r-10">Back</a>
                        <button type="button" id="btnSaveSchedule" onclick="Schedule.save()" class="btn waves-effect waves-light btn-info pull-right m-r-10">Save</button>
                        <button type="button" onclick="Schedule.saveScheduleing()" class="hide btn waves-effect waves-light btn-info pull-right m-r-10">Save</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- for active activity prevent scheduling from updation-->
<div class="modal fade user-search-poppus" id="prevent-scheduling-updation" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm</h5>
            </div>
            <div class="modal-body">
                <div class="sf-submit-info">
                    Are you sure want to active/deactivate selected user?
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="Variable.delete()" class="btn-sm waves-effect waves-light btn-info" data-dismiss="modal">Yes</button>
                <button type="button" class="btn-sm  btn btn-inverse waves-effect waves-light" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="/content/assets/plugins/moment/moment.js"></script>
    <script src="/content/assets/plugins/daterangepicker/daterangepicker.js"></script>

    <script src="/content/assets/plugins/bootstrap-select/bootstrap-select.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script>
        $(function () {
            typeof isAsync === 'undefined' ? isAsync = true : false;

            $('.wizard-content ul li:eq(3)').removeClass('disabled').addClass('current');
            $('#sidebarnav > li').removeClass('active');
            $('#sidebarnav > li:nth-child(5)').addClass('active');

            Schedule.GetAllRoles();
            Schedule.GetScheduledActivity();

            $('.singledate').daterangepicker({
                singleDatePicker: true,
                showDropdowns: true,
                locale: { format: '@Aspree.Utility.ConfigSettings.DateFormat.ToUpper()', } // 'DD-MM-YYYY' //format: 'YYYY-MM-DD'
            });
        });

        $(".list-dropdown > a").click(function () {
            if ($(this).parent().hasClass("active")) {
                $(".list-dropdown", $(this).parent()).removeClass("active");
                $(".list-submenu", $(this).parent()).slideUp(200);
                $(this).parent().removeClass("active");
            } else {
                $(".list-dropdown", $(this).parent()).removeClass("active");
                $(this).next(".list-submenu").slideDown(200);
                $(this).parent().addClass("active");
            }
        });
    </script>
    @Scripts.Render("~/apps/schedules")
    @Scripts.Render("~/bundles/jqueryval")
}

@section Styles{
    <link href="/content/assets/plugins/wizard/steps.css" rel="stylesheet">
    <link href="/content/assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
    <link href="/content/assets/plugins/daterangepicker/daterangepicker.css" rel="stylesheet">
}
