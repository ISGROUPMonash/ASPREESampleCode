@model  List<Aspree.Core.ViewModels.ActivityCategoryViewModel>
@{
    ViewBag.Title = "Deployment";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
    bool IsProjectAdmin = ViewBag.LoggedInUser.Roles.Contains("Project Admin");
    bool IsSystemAdmin = ViewBag.LoggedInUser.Roles.Contains("System Admin");

    string testSiteUrl = string.Empty;
    try
    {
        testSiteUrl = Aspree.Utility.ConfigSettings.WebUrlTestSite;
    }
    catch (Exception exf)    {    }
}



@section NavBarLeft{
    <h3 class="text-themecolor m-b-0 m-t-0">Project Builder</h3>
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
        <li class="breadcrumb-item">Project Builder</li>
        <li class="breadcrumb-item active">Deployment</li>
    </ol>
}

<div class="col-sm-4 col-md-4 col-lg-3">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Library</h3>
            <h4 class="card-subtitle">Existing Activities</h4>
            <form class="form-horizontal" autocomplete="off">
                <div class="input-group form-group">
                    <input onkeyup="Deployment.searchExistingActivities(false)" class="form-control" id="search-var-text" style="border-radius: .25rem 0 0 .25rem;" />
                    <div class="input-group-append">
                        <button onclick="Deployment.searchExistingActivities(true)" class="btn btn-info" type="button"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            </form>
        </div><!-- /.card-header -->
        <div class="card-body" style="max-height:550px; overflow:auto;">
            <div class="pb-library-list-wrap">
                <div class="list-menu-wrap">
                    <ul class="list-menu" id="scheduledActivitiesList">
                        @foreach (var menu in Model)
                        {
                            <li class="list-dropdown">
                                <a href="javascript:void(0);" onmousedown="Deployment.setCurrentActivity('@menu.Guid', '@menu.CategoryName', true, '@menu.CategoryName', '', '@menu.Guid')" data-id="@menu.Guid">@menu.CategoryName</a>
                                <div class="list-submenu" style="display:none">
                                    <ul  class="variable-categories">
                                        @foreach (var subMenu in menu.Activities)
                                        {
                                            if (ViewBag.ProjectId.ToString() == subMenu.ProjectId.ToString())
                                            {
                                                string isActVarApproved = subMenu.IsAllVariableApprovedOfActivity ? "true" : "false";

                                                <li id="li-@subMenu.Guid" data-activity-id="@subMenu.Guid" class="activities-list-entered-label">
                                                    <a class="sub-category-txt"
                                                       data-is-default-variable="@subMenu.IsDefaultVariable"
                                                       data-deployment-status="@subMenu.DeploymentStatus"
                                                       data-text="@subMenu.Name.ToLower()"
                                                       data-text-display="@subMenu.Name"
                                                       onmousedown="Deployment.setCurrentActivity('@subMenu.Guid', '@subMenu.Name', false, '@menu.CategoryName', '@subMenu.RepeatationCount', '@menu.Guid', '@isActVarApproved', '@subMenu.IsDefaultVariable')"
                                                       href="javascript:void(0);"
                                                       data-id="@subMenu.Guid"
                                                       data-repeatation-count="@subMenu.RepeatationCount"
                                                       data-activity-variables-approved="@subMenu.IsAllVariableApprovedOfActivity"
                                                       ondblclick="Deployment.addActivityInContainer('@subMenu.Guid','@subMenu.Name', '@subMenu.RepeatationCount', '@menu.CategoryName', '@menu.Guid', @isActVarApproved, @subMenu.IsDefaultVariable)"
                                                       >
                                                        @subMenu.Name
                                                        <i id="activityStatusLabel-@subMenu.Guid">@(subMenu.DeploymentStatus == (int)Aspree.Core.Enum.ActivityDeploymentStatus.Deployed ? "(Active)" : "") </i>
                                                    </a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="col-sm-8 col-md-8 col-lg-9">
    <input type="hidden" id="ProjectId" name="ProjectId" value="@ViewBag.ProjectId" />
    <div class="card">
        <div class="card-body">
            @Html.Partial("~/Views/Shared/ProjectBuilder.cshtml")
        </div>
        <div class="row p-10">
            <div class="col-sm-3 col-md-3 col-lg-4">
                <div class="card">
                    <div class="card-header">
                        Select activities to deploy
                    </div>
                    <div class="card-body" id="activitiesContainer" style="min-height:300px">
                        <h2 id="drag-message" class="text-center">Drag and drop your activities here</h2>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 col-md-7 col-lg-8">
                <div class="card">
                    <div class="card-header row">
                        <div class="col-md-10">
                            Push selected activities to testing User Interface:<br />
                            (i.e. http://TESTUniversalDataSystem.monash.edu)
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn waves-effect waves-light btn-info pull-right m-r-10 mt-1" onclick="Deployment.PushActivitiesToTestSite()">Push</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="role-model-error"></div>
                        <div style="height:400px">
                            <input type="hidden" id="ProjectId" name="ProjectId" value="@ViewBag.ProjectId" />
                            <form class="form-horizontal">
                                <div class="form-group row mb-2">
                                    <div class="col-md-12 hide">
                                        <label for="Link" class="col-form-label float-left">Link :</label>
                                        <div class="col-6 float-left">
                                            <input type="hidden" id="ProjectName" value="@ViewBag.ProjectName" />
                                            <input class="form-control form-control-sm" type="text" id="ProjectUrl" name="ProjectUrl" />
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div>
                                <!--class="border-top"-->
                                <label for="Testingchecklist" class="col-form-label">Testing Checklist:</label>
                                <div class="form-group mb-2 testing-checklist">
                                    <label class="custom-control custom-checkbox">
                                        <input type="checkbox" name="RequiredVariable" id="RequiredVariable" class="custom-control-input" />
                                        <span class="custom-control-label">All required variables on forms.</span>
                                    </label>
                                    <label class="custom-control custom-checkbox">
                                        <input type="checkbox" name="RequiredVariable" id="RequiredVariable" class="custom-control-input" />
                                        <span class="custom-control-label">All forms work as expected.</span>
                                    </label>
                                    <label class="custom-control custom-checkbox">
                                        <input type="checkbox" name="RequiredVariable" id="RequiredVariable" class="custom-control-input" />
                                        <span class="custom-control-label">All activities work as expected.</span>
                                    </label>
                                    <label class="custom-control custom-checkbox">
                                        <input type="checkbox" name="RequiredVariable" id="RequiredVariable" class="custom-control-input" />
                                        <span class="custom-control-label">All required activities can only be created as scheduled.</span>
                                    </label>
                                </div>
                                <div class="border-top">
                                    <label for="DeployMyProject" class="col-form-label pb-0">Deploy My Activity </label>
                                    <div class="form-group">
                                        <label for="deploytext" class="col-form-label">If your activity works as expected and the testing is completed, press the button below to deploy your activity.</label>
                                        @if (IsSystemAdmin || IsProjectAdmin)
                                        {
                                            <button type="button" title="Deploy activities" onclick="Deployment.validateDeploymentChecklist()" class="btn waves-effect waves-light btn-info pull-left m-r-10">Deploy</button>
                                        }
                                        else
                                        {
                                            <button type="button" title="You do not have permission to deploy activities, Please login as System admin" class="btn waves-effect waves-light btn-info pull-left m-r-10 disabled-button-cursor" disabled>Deploy</button>
                                        }
                                        <button type="button" id="btnInactivateActivity" class="btn waves-effect waves-light btn-googleplus pull-left m-r-10 hide">Inactivate</button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--template for drag and drop activities-->
<div class="hide">
    <div id="activityTemplate">
        <div class="row">
            <div class="col-lg-2  p-l-0">
                <i class="mdi mdi-menu" style="font-size:22px;cursor: ns-resize" title="Move Up/Down"></i>
            </div>
            <div class="col-lg-9  p-l-0 var-label">
            </div>
            <div class="col-lg-1  p-l-0 p-r-0">
                <button type="button" title="Remove" onclick="Deployment.removeDeploymentDragDropActivity(this)" class="btn btn-sm waves-effect waves-light btn-danger pull-right">
                    <i class="far fa-times-circle"></i>
                </button>
            </div>
        </div>
    </div>
</div>


<!--Deployment of activities confirmation-->
<div class="modal fade user-search-poppus" id="manage-confirm" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm</h5>
            </div>
            <div class="modal-body">
                <div class="sf-submit-info">
                    Are you sure you want to deploy this activity?
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="sf-submit-button btn-sm waves-effect waves-light btn-info" data-dismiss="modal">Yes</button>
                <button type="button" class="btn-sm  btn btn-inverse waves-effect waves-light" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>



@section Scripts{
    <script src="/content/assets/plugins/moment/moment.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script>
        $(function () {
            Deployment.TestSiteWebUrl = "@(testSiteUrl)";

            $('.wizard-content ul li:eq(4)').removeClass('disabled').addClass('current');
            $('#sidebarnav > li').removeClass('active');
            $('#sidebarnav > li:nth-child(5)').addClass('active');
            Deployment.GetScheduledActivity();
        })

        $(".list-dropdown > a").click(function () {
            if ($(this).parent().hasClass("active")) {
                $(".list-dropdown", $(this).parent()).removeClass("active");
                $(".list-submenu", $(this).parent()).slideUp(200);
                $(this).parent().removeClass("active");
            } else {
                $(".list-dropdown", $(this).parent()).removeClass("active");
                $(this).next(".list-submenu").slideDown(200);
                $(this).parent().addClass("active");
            }
        });
    </script>
    @Scripts.Render("~/apps/deployments")
}

@section Styles{
    <link href="/content/assets/plugins/wizard/steps.css" rel="stylesheet">
}
